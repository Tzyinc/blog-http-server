{"ast":null,"code":"import _defineProperty from\"/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import{withRouter}from\"react-router-dom\";import SideBar from\"./components/SideBar\";import MainContainer from\"./components/MainContainer\";import{parseQueryStringToObj}from\"../../utils\";import{initUrlDocument}from\"../../utils/fetch\";import jsonpack from\"jsonpack/main\";import withS2T from\"../Utils/Speech2Text\";import{getDocument,createSection as _createSection,setText,setTags,deleteSection as _deleteSection,generateTags}from\"../../utils/fetch\";import\"./style.css\";var Body=/*#__PURE__*/function(_Component){_inherits(Body,_Component);function Body(_props){var _this;_classCallCheck(this,Body);_this=_possibleConstructorReturn(this,_getPrototypeOf(Body).call(this,_props));_this.editSection=function(sectionId,text){if(sectionId&&text){var index=_this.state.sections.findIndex(function(section){return section.sectionId===sectionId;});var frontSections=_this.state.sections.slice(0,index);var backSections=_this.state.sections.slice(index+1,_this.state.sections.length);_this.setState({sections:[].concat(_toConsumableArray(frontSections),[_objectSpread({},_this.state.sections[index],{text:text})],_toConsumableArray(backSections))});}};_this.saveSection=function(sectionId){var sections=_this.state.sections;var currentSection=sections.find(function(section){return section.sectionId===sectionId;});if(currentSection){setText(sectionId,currentSection.text).then(function(data){var summary=data&&data.summary;if(summary){_this.setSectionSummary(sectionId,summary);}});}_this.setAllTags();};_this.getDocumentIdFromUrl=function(givenProps){var props=givenProps||_this.props;return parseQueryStringToObj(props.location.search).id;};_this.setDocumentId=function(id){_this.setState({documentId:id});};_this.setSectionSummary=function(sectionId,summary){var sections=_this.state.sections;var orderIndex=sections.findIndex(function(section){return section.sectionId===sectionId;});var topSections=sections.slice(0,orderIndex);var bottomSections=sections.slice(orderIndex+1,sections.length);_this.setState({sections:[].concat(_toConsumableArray(topSections),[_objectSpread({},sections[orderIndex],{summary:summary})],_toConsumableArray(bottomSections))});};_this.setAllTags=function(){generateTags(_this.state.documentId).then(function(data){var currentSections=_this.state.sections;_this.setState({sections:currentSections.map(function(section,index){// console.log('setalltagcallback', section , data.sections, data.sections[section.id], section.id )\nvar sectionTags=data.sections[section.sectionId]?data.sections[section.sectionId].tags:[];if(sectionTags){return _objectSpread({},section,{tags:sectionTags});}else{return section;}})});});};_this.handleStartRecording=function(){_this.setState({isRecording:true});_this.createSection();_this.props.startRecord();};_this.handleRecordNext=function(){_this.saveSection(_this.state.currentSectionId);_this.handleStartRecording();};_this.handleStopRecording=function(){_this.saveSection(_this.state.currentSectionId);_this.props.stopRecord();_this.setState({isRecording:false},_this.setAllTags);};_this.handleChangeDocTitle=function(title){_this.setState({documentTitle:title});};_this.handleSaveTagsClick=function(sectionId,newTags){var section=_this.state.sections.find(function(s){return s.sectionId===sectionId;});if(section&&newTags){setTags(sectionId,newTags);}};var queryString=_props.location.search;var query=parseQueryStringToObj(queryString);var defaultState={sections:[],currentSectionId:0,lastRecordedTranscript:\"\",documentId:query.id||null,documentTitle:\"\",isRecording:false};if(query&&query.d){var doc=jsonpack.unpack(query.d);var keys=Object.keys(doc);var item=doc[keys[0]];defaultState.sections=JSON.parse(JSON.stringify(item.sections));defaultState.sections.shift();defaultState.currentSectionId=item.sections.length;defaultState.documentId=item.title;defaultState.documentTitle=item.title;initUrlDocument(_defineProperty({},keys[0],item));}_this.deleteSection=_this.deleteSection.bind(_assertThisInitialized(_this));_this.state=defaultState;return _this;}_createClass(Body,[{key:\"deleteSection\",value:function deleteSection(sectionId){var sections=this.state.sections;var deletedSection=sections.find(function(section){return section.sectionId===sectionId;});if(sectionId&&deletedSection){_deleteSection(sectionId);this.setState({sections:sections.filter(function(section){return section.sectionId!==sectionId;})});}}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(nextProps){var urlDocumentId=this.getDocumentIdFromUrl(nextProps);if(nextProps.documentId!==urlDocumentId){this.setDocumentId(urlDocumentId);}if(nextProps.lastRecordedTranscript!==this.state.lastRecordedTranscript){this.setState({lastRecordedTranscript:nextProps.lastRecordedTranscript});if(this.state.sections.length===0){this.createSection();}else{this.updateSectionText(this.state.currentSectionId,nextProps.lastRecordedTranscript);}}}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var documentId=this.state.documentId;if(documentId){getDocument(documentId).then(function(data){var sections=data&&data.sections;var title=data&&data.title;if(sections&&title){_this2.setState({documentTitle:title,sections:sections.map(function(section){return{sectionId:section.id,summary:section.summary,text:section.text,timestamp:section.timestamp,tags:section.tags};})});}});}}},{key:\"createSection\",value:function createSection(){var _this3=this;var documentId=this.state.documentId;if(documentId){_createSection(documentId).then(function(data){var sectionId=data&&data.id;var timestamp=data&&data.timestamp;if(sectionId){_this3.setState({sections:[].concat(_toConsumableArray(_this3.state.sections),[{text:\"\",sectionId:sectionId,timestamp:timestamp}]),currentSectionId:sectionId});}});}}},{key:\"updateSectionText\",value:function updateSectionText(sectionId,text){if(sectionId&&text){var oldSections=Array.from(this.state.sections);var lastSection=oldSections[oldSections.length-1];if(lastSection.sectionId===sectionId){this.setState({sections:[].concat(_toConsumableArray(oldSections.slice(0,-1)),[_objectSpread({},lastSection,{text:\"\".concat(lastSection.text).concat(text)})])});}}}},{key:\"render\",value:function render(){var _this$state=this.state,documentId=_this$state.documentId,documentTitle=_this$state.documentTitle,isRecording=_this$state.isRecording,sections=_this$state.sections;return React.createElement(\"div\",{className:\"main-body\"},React.createElement(SideBar,{onChangeDocumentTitle:this.handleChangeDocTitle,documentId:documentId,documentTitle:documentTitle,isRecording:isRecording,onStartRecording:this.handleStartRecording,onStopRecording:this.handleStopRecording,handleRecordNext:this.handleRecordNext,setDocumentId:this.setDocumentId}),React.createElement(MainContainer,{sections:sections,deleteSection:this.deleteSection,editSection:this.editSection,saveSection:this.saveSection,onSaveTagsClick:this.handleSaveTagsClick}));}}]);return Body;}(Component);export default withS2T(withRouter(Body));","map":{"version":3,"sources":["/Users/tenzy/Documents/work/vata-hackathon-fe/atva/src/components/Body/index.js"],"names":["React","Component","withRouter","SideBar","MainContainer","parseQueryStringToObj","initUrlDocument","jsonpack","withS2T","getDocument","createSection","setText","setTags","deleteSection","generateTags","Body","props","editSection","sectionId","text","index","state","sections","findIndex","section","frontSections","slice","backSections","length","setState","saveSection","currentSection","find","then","data","summary","setSectionSummary","setAllTags","getDocumentIdFromUrl","givenProps","location","search","id","setDocumentId","documentId","orderIndex","topSections","bottomSections","currentSections","map","sectionTags","tags","handleStartRecording","isRecording","startRecord","handleRecordNext","currentSectionId","handleStopRecording","stopRecord","handleChangeDocTitle","title","documentTitle","handleSaveTagsClick","newTags","s","queryString","query","defaultState","lastRecordedTranscript","d","doc","unpack","keys","Object","item","JSON","parse","stringify","shift","bind","deletedSection","filter","nextProps","urlDocumentId","updateSectionText","timestamp","oldSections","Array","from","lastSection"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\n\nimport SideBar from \"./components/SideBar\";\nimport MainContainer from \"./components/MainContainer\";\n\nimport { parseQueryStringToObj } from \"../../utils\";\n\nimport { initUrlDocument } from \"../../utils/fetch\";\n\nimport jsonpack from \"jsonpack/main\";\n\nimport withS2T from \"../Utils/Speech2Text\";\nimport {\n  getDocument,\n  createSection,\n  setText,\n  setTags,\n  deleteSection,\n  generateTags\n} from \"../../utils/fetch\";\n\nimport \"./style.css\";\n\nclass Body extends Component {\n  constructor(props) {\n    super(props);\n    const queryString = props.location.search;\n    const query = parseQueryStringToObj(queryString);\n\n    let defaultState = {\n      sections: [],\n      currentSectionId: 0,\n      lastRecordedTranscript: \"\",\n      documentId: query.id || null,\n      documentTitle: \"\",\n      isRecording: false\n    };\n\n    if (query && query.d) {\n      const doc = jsonpack.unpack(query.d);\n      const keys = Object.keys(doc);\n      const item = doc[keys[0]];\n      defaultState.sections = JSON.parse(JSON.stringify(item.sections));\n      defaultState.sections.shift();\n      defaultState.currentSectionId = item.sections.length;\n      defaultState.documentId = item.title;\n      defaultState.documentTitle = item.title;\n      initUrlDocument({[keys[0]]: item})\n    }\n    this.deleteSection = this.deleteSection.bind(this);\n    this.state = defaultState;\n  }\n\n  deleteSection(sectionId) {\n    const { sections } = this.state;\n    const deletedSection = sections.find(\n      section => section.sectionId === sectionId\n    );\n\n    if (sectionId && deletedSection) {\n      deleteSection(sectionId);\n      this.setState({\n        sections: sections.filter(section => section.sectionId !== sectionId)\n      });\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const urlDocumentId = this.getDocumentIdFromUrl(nextProps);\n    if (nextProps.documentId !== urlDocumentId) {\n      this.setDocumentId(urlDocumentId);\n    }\n\n    if (\n      nextProps.lastRecordedTranscript !== this.state.lastRecordedTranscript\n    ) {\n      this.setState({\n        lastRecordedTranscript: nextProps.lastRecordedTranscript\n      });\n      if (this.state.sections.length === 0) {\n        this.createSection();\n      } else {\n        this.updateSectionText(\n          this.state.currentSectionId,\n          nextProps.lastRecordedTranscript\n        );\n      }\n    }\n  }\n\n  componentDidMount() {\n    const { documentId } = this.state;\n    if (documentId) {\n      getDocument(documentId).then(data => {\n        const sections = data && data.sections;\n        const title = data && data.title;\n        if (sections && title) {\n          this.setState({\n            documentTitle: title,\n            sections: sections.map(section => ({\n              sectionId: section.id,\n              summary: section.summary,\n              text: section.text,\n              timestamp: section.timestamp,\n              tags: section.tags\n            }))\n          });\n        }\n      });\n    }\n  }\n\n  createSection() {\n    const { documentId } = this.state;\n\n    if (documentId) {\n      createSection(documentId).then(data => {\n        const sectionId = data && data.id;\n        const timestamp = data && data.timestamp;\n\n        if (sectionId) {\n          this.setState({\n            sections: [\n              ...this.state.sections,\n              { text: \"\", sectionId, timestamp }\n            ],\n            currentSectionId: sectionId\n          });\n        }\n      });\n    }\n  }\n\n  updateSectionText(sectionId, text) {\n    if (sectionId && text) {\n      const oldSections = Array.from(this.state.sections);\n      const lastSection = oldSections[oldSections.length - 1];\n      if (lastSection.sectionId === sectionId) {\n        this.setState({\n          sections: [\n            ...oldSections.slice(0, -1),\n            {\n              ...lastSection,\n              text: `${lastSection.text}${text}`\n            }\n          ]\n        });\n      }\n    }\n  }\n\n  editSection = (sectionId, text) => {\n    if (sectionId && text) {\n      const index = this.state.sections.findIndex(\n        section => section.sectionId === sectionId\n      );\n      const frontSections = this.state.sections.slice(0, index);\n      const backSections = this.state.sections.slice(\n        index + 1,\n        this.state.sections.length\n      );\n      this.setState({\n        sections: [\n          ...frontSections,\n          {\n            ...this.state.sections[index],\n            text\n          },\n          ...backSections\n        ]\n      });\n    }\n  }\n\n  saveSection = (sectionId) => {\n    const { sections } = this.state;\n    const currentSection = sections.find(\n      section => section.sectionId === sectionId\n    );\n\n    if (currentSection) {\n      setText(sectionId, currentSection.text).then(data => {\n        const summary = data && data.summary;\n\n        if (summary) {\n          this.setSectionSummary(sectionId, summary);\n        }\n      });\n    }\n    this.setAllTags();\n  }\n\n  getDocumentIdFromUrl = givenProps => {\n    const props = givenProps || this.props;\n    return parseQueryStringToObj(props.location.search).id;\n  };\n\n  setDocumentId = id => {\n    this.setState({\n      documentId: id\n    });\n  };\n\n  setSectionSummary = (sectionId, summary) => {\n    const { sections } = this.state;\n    const orderIndex = sections.findIndex(\n      section => section.sectionId === sectionId\n    );\n    const topSections = sections.slice(0, orderIndex);\n    const bottomSections = sections.slice(orderIndex + 1, sections.length);\n\n    this.setState({\n      sections: [\n        ...topSections,\n        { ...sections[orderIndex], summary },\n        ...bottomSections\n      ]\n    });\n  };\n\n  setAllTags = () => {\n    generateTags(this.state.documentId).then(data => {\n      const currentSections = this.state.sections;\n      this.setState({\n        sections: currentSections.map((section, index) => {\n          // console.log('setalltagcallback', section , data.sections, data.sections[section.id], section.id )\n          const sectionTags = data.sections[section.sectionId] ? data.sections[section.sectionId].tags : [];\n          if (sectionTags) {\n            return {\n              ...section,\n              tags: sectionTags\n            };\n          } else {\n            return section;\n          }\n        })\n      });\n    });\n  };\n\n  handleStartRecording = () => {\n    this.setState({\n      isRecording: true\n    });\n    this.createSection();\n\n    this.props.startRecord();\n  };\n\n  handleRecordNext = () => {\n    this.saveSection(this.state.currentSectionId);\n\n    this.handleStartRecording();\n  };\n\n  handleStopRecording = () => {\n    this.saveSection(this.state.currentSectionId);\n    this.props.stopRecord();\n    this.setState(\n      {\n        isRecording: false\n      },\n      this.setAllTags\n    );\n  };\n\n  handleChangeDocTitle = title => {\n    this.setState({\n      documentTitle: title\n    });\n  };\n\n  handleSaveTagsClick = (sectionId, newTags) => {\n    const section = this.state.sections.find(s => s.sectionId === sectionId);\n\n    if (section && newTags) {\n      setTags(sectionId, newTags);\n    }\n  };\n\n  render() {\n    const { documentId, documentTitle, isRecording, sections } = this.state;\n\n    return (\n      <div className=\"main-body\">\n        <SideBar\n          onChangeDocumentTitle={this.handleChangeDocTitle}\n          documentId={documentId}\n          documentTitle={documentTitle}\n          isRecording={isRecording}\n          onStartRecording={this.handleStartRecording}\n          onStopRecording={this.handleStopRecording}\n          handleRecordNext={this.handleRecordNext}\n          setDocumentId={this.setDocumentId}\n        />\n        <MainContainer\n          sections={sections}\n          deleteSection={this.deleteSection}\n          editSection={this.editSection}\n          saveSection={this.saveSection}\n          onSaveTagsClick={this.handleSaveTagsClick}\n        />\n      </div>\n    );\n  }\n}\n\nexport default withS2T(withRouter(Body));\n"]},"metadata":{},"sourceType":"module"}