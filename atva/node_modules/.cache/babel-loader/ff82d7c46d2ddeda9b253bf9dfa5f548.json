{"ast":null,"code":"/*\n    Sample space of observed events\n    Copyright (C) 2018 Hugo W.L. ter Doest\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\nvar Context = require('./Context');\n\nvar fs = require('fs');\n\nfunction Sample(elements) {\n  this.frequencyOfContext = {};\n  this.frequency = {};\n  this.classes = [];\n\n  if (elements) {\n    this.elements = elements;\n    this.analyse();\n  } else {\n    this.elements = [];\n  }\n} // Extracts classes and frequencies\n\n\nSample.prototype.analyse = function () {\n  var that = this;\n  this.elements.forEach(function (x) {\n    if (this.classes.indexOf(x.a) === -1) {\n      this.classes.push(x.a);\n    }\n\n    if (!that.frequencyOfContext[x.b.toString()]) {\n      that.frequencyOfContext[x.b.toString()] = 0;\n    }\n\n    that.frequencyOfContext[x.b.toString()]++;\n\n    if (!that.frequency[x.toString()]) {\n      that.frequency[x.toString()] = 0;\n    }\n\n    that.frequency[x.toString()]++;\n  });\n};\n\nSample.prototype.addElement = function (x) {\n  this.elements.push(x); // Update frequencies\n\n  if (!this.frequencyOfContext[x.b.toString()]) {\n    this.frequencyOfContext[x.b.toString()] = 0;\n  }\n\n  this.frequencyOfContext[x.b.toString()]++;\n\n  if (!this.frequency[x.toString()]) {\n    this.frequency[x.toString()] = 0;\n  }\n\n  this.frequency[x.toString()]++; // Update classes\n\n  if (this.classes.indexOf(x.a) === -1) {\n    this.classes.push(x.a);\n  }\n};\n\nSample.prototype.observedProbabilityOfContext = function (context) {\n  if (this.frequencyOfContext[context.toString()]) {\n    return this.frequencyOfContext[context.toString()] / this.elements.length;\n  } else {\n    return 0;\n  }\n};\n\nSample.prototype.observedProbability = function (x) {\n  if (this.frequency[x.toString()]) {\n    return this.frequency[x.toString()] / this.elements.length;\n  } else {\n    return 0;\n  }\n};\n\nSample.prototype.size = function () {\n  return this.elements.length;\n};\n\nSample.prototype.getClasses = function () {\n  return this.classes;\n};\n\nSample.prototype.generateFeatures = function (featureSet) {\n  this.elements.forEach(function (x) {\n    x.generateFeatures(featureSet);\n  });\n};\n\nSample.prototype.save = function (filename, callback) {\n  var sample = this;\n  var data = JSON.stringify(this, null, 2);\n  fs.writeFile(filename, data, 'utf8', function (err) {\n    //console.log('Sample written')\n    if (callback) {\n      callback(err, err ? null : sample);\n    }\n  });\n}; // Loads a sample from file and revives the right classes, i.e. Sample and\n// Element classes.\n\n\nSample.prototype.load = function (filename, elementClass, callback) {\n  fs.readFile(filename, 'utf8', function (err, data) {\n    if (!err) {\n      var sampleData = JSON.parse(data);\n      var sample = new Sample();\n      sampleData.elements.forEach(function (elementData) {\n        var elt = new elementClass(elementData.a, new Context(elementData.b.data));\n        sample.addElement(elt);\n      });\n\n      if (!sample.frequency || !sample.frequencyOfContext) {\n        sample.analyse();\n      }\n\n      if (callback) {\n        callback(err, sample);\n      }\n    } else {\n      if (callback) {\n        callback(err);\n      }\n    }\n  });\n};\n\nmodule.exports = Sample;","map":{"version":3,"sources":["/Users/tenzy/Documents/work/vata-hackathon-fe/atva/node_modules/natural/lib/natural/classifiers/maxent/Sample.js"],"names":["Context","require","fs","Sample","elements","frequencyOfContext","frequency","classes","analyse","prototype","that","forEach","x","indexOf","a","push","b","toString","addElement","observedProbabilityOfContext","context","length","observedProbability","size","getClasses","generateFeatures","featureSet","save","filename","callback","sample","data","JSON","stringify","writeFile","err","load","elementClass","readFile","sampleData","parse","elementData","elt","module","exports"],"mappings":"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","sourcesContent":["/*\n    Sample space of observed events\n    Copyright (C) 2018 Hugo W.L. ter Doest\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\nvar Context = require('./Context');\n\nvar fs = require('fs');\n\nfunction Sample(elements) {\n  this.frequencyOfContext = {};\n  this.frequency = {};\n  this.classes = [];\n  if (elements) {\n    this.elements = elements;\n    this.analyse();\n  }\n  else {\n    this.elements = [];\n  }\n}\n\n// Extracts classes and frequencies\nSample.prototype.analyse = function() {\n  var that = this;\n  this.elements.forEach(function(x) {\n    if (this.classes.indexOf(x.a) === -1) {\n      this.classes.push(x.a);\n    }\n    if (!that.frequencyOfContext[x.b.toString()]) {\n      that.frequencyOfContext[x.b.toString()] = 0;\n    }\n    that.frequencyOfContext[x.b.toString()]++;\n    if (!that.frequency[x.toString()]) {\n      that.frequency[x.toString()] = 0;\n    }\n    that.frequency[x.toString()]++;\n  });\n};\n\nSample.prototype.addElement = function(x) {\n  this.elements.push(x);\n  // Update frequencies\n  if (!this.frequencyOfContext[x.b.toString()]) {\n    this.frequencyOfContext[x.b.toString()] = 0;\n  }\n  this.frequencyOfContext[x.b.toString()]++;\n  if (!this.frequency[x.toString()]) {\n    this.frequency[x.toString()] = 0;\n  }\n  this.frequency[x.toString()]++;\n  // Update classes\n  if (this.classes.indexOf(x.a) === -1) {\n    this.classes.push(x.a);\n  }\n};\n\nSample.prototype.observedProbabilityOfContext = function(context) {\n  if (this.frequencyOfContext[context.toString()]) {\n    return this.frequencyOfContext[context.toString()] / this.elements.length;\n  }\n  else {\n    return 0;\n  }\n};\n\nSample.prototype.observedProbability = function(x) {\n  if (this.frequency[x.toString()]) {\n    return this.frequency[x.toString()] / this.elements.length;\n  }\n  else {\n    return 0;\n  }\n};\n\nSample.prototype.size = function() {\n  return this.elements.length;\n};\n\nSample.prototype.getClasses = function() {\n  return this.classes;\n};\n\nSample.prototype.generateFeatures = function(featureSet) {\n  this.elements.forEach(function(x) {\n    x.generateFeatures(featureSet);\n  });\n};\n\nSample.prototype.save = function(filename, callback) {\n  var sample = this;\n  var data = JSON.stringify(this, null, 2);\n  fs.writeFile(filename, data, 'utf8', function(err) {\n      //console.log('Sample written')\n      if(callback) {\n          callback(err, err ? null : sample);\n      }\n  });\n};\n\n// Loads a sample from file and revives the right classes, i.e. Sample and\n// Element classes.\nSample.prototype.load = function(filename, elementClass, callback) {\n  fs.readFile(filename, 'utf8', function(err, data) {\n\n    if(!err) {\n        var sampleData = JSON.parse(data);\n        var sample = new Sample();\n        sampleData.elements.forEach(function(elementData) {\n          var elt = new elementClass(elementData.a, new Context(elementData.b.data));\n          sample.addElement(elt);\n        });\n        if (!sample.frequency || !sample.frequencyOfContext) {\n          sample.analyse();\n        }\n        if (callback) {\n          callback(err, sample);\n        }\n    }\n    else {\n      if (callback) {\n        callback(err);\n      }\n    }\n  });\n};\n\nmodule.exports = Sample;\n"]},"metadata":{},"sourceType":"script"}