<html>
<head>
    <meta charset="UTF-8">
    <script language="javascript" type="text/javascript" src="libraries/p5.js"></script>
    <script language="javascript" src="libraries/p5.dom.js"></script>
    <script language="javascript" src="libraries/p5.sound.js"></script>
    <script language="javascript" type="text/javascript" src="sketch.js"></script>
    <script language="javascript" type="text/javascript" src="Player.js"></script>
    <script language="javascript" type="text/javascript" src="Line.js"></script>
    <script language="javascript" type="text/javascript" src="Level.js"></script>
    <script language="javascript" type="text/javascript" src="LevelSetupFunction.js"></script>
    <script language="javascript" type="text/javascript" src="Brain.js"></script>
    <script language="javascript" type="text/javascript" src="Population.js"></script>
    <script language="javascript" type="text/javascript" src="Coin.js"></script>
    <style>
        body {
            background-color: rgb(30,30,30);
            color: white;
        }
        button {
            -webkit-user-select: none; /* Safari */        
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+/Edge */
            user-select: none; /* Standard */
        }
    </style>
    <script>
        Podium = {};

        Podium.keydown = function(k) {
            var oEvent = document.createEvent('KeyboardEvent');

            // Chromium Hack
            Object.defineProperty(oEvent, 'keyCode', {
                        get : function() {
                            return this.keyCodeVal;
                        }
            });     
            Object.defineProperty(oEvent, 'which', {
                        get : function() {
                            return this.keyCodeVal;
                        }
            });     

            if (oEvent.initKeyboardEvent) {
                oEvent.initKeyboardEvent("keydown", true, true, document.defaultView, k, k, "", "", false, "");
            } else {
                oEvent.initKeyEvent("keydown", true, true, document.defaultView, false, false, false, false, k, 0);
            }

            oEvent.keyCodeVal = k;

            if (oEvent.keyCode !== k) {
                alert("keyCode mismatch " + oEvent.keyCode + "(" + oEvent.which + ")");
            }

            document.body.dispatchEvent(oEvent);
        }

        Podium.keyup = function(k) {
            var oEvent = document.createEvent('KeyboardEvent');

            // Chromium Hack
            Object.defineProperty(oEvent, 'keyCode', {
                        get : function() {
                            return this.keyCodeVal;
                        }
            });     
            Object.defineProperty(oEvent, 'which', {
                        get : function() {
                            return this.keyCodeVal;
                        }
            });     

            if (oEvent.initKeyboardEvent) {
                oEvent.initKeyboardEvent("keyup", true, true, document.defaultView, k, k, "", "", false, "");
            } else {
                oEvent.initKeyEvent("keyup", true, true, document.defaultView, false, false, false, false, k, 0);
            }

            oEvent.keyCodeVal = k;

            if (oEvent.keyCode !== k) {
                alert("keyCode mismatch " + oEvent.keyCode + "(" + oEvent.which + ")");
            }

            document.body.dispatchEvent(oEvent);
        }
        let touchState = {
            left: false,
            right: false,
            middle: false,
            uLeft: false,
            uRight: false,
        }
        // const ongoingTouches = [];

        function startup() {
            const canvasDiv = document.getElementById('canvas');
            const handleStart = (evt) => {
                evt.preventDefault();
                const touches = evt.changedTouches;
                for (let i = 0; i < touches.length; i++) {
                    // ongoingTouches.push(copyTouch(touches[i]));

                    let x = touches[i].pageX;
                    let y = touches[i].pageY;
                    let maxX = touches[i].target.offsetWidth;
                    let maxY = touches[i].target.offsetHeight;
                    switch (true) {
                        case (x < maxX/3 && x > 0 && y > maxY/2 && y < maxY):
                            Podium.keydown(37);
                            touchState.left = true;
                            break;
                        case (x < maxX/3 && x > 0 && y < maxY/2 && y > 0):
                            Podium.keydown(37);
                            touchState.uLeft = true;
                            break;
                        case (x < maxX && x > maxX/3*2 && y > maxY/2 && y < maxY):
                            Podium.keydown(39);
                            touchState.right = true;
                            break;
                        case (x < maxX && x > maxX/3*2  && y < maxY/2 && y > 0):
                            Podium.keydown(39);
                            touchState.uRight = true;
                            break;
                        case (x < maxX/3*2  && x > maxX/3):
                            Podium.keydown(32);
                            touchState.middle = true;
                            break;
                        default: break;
                    }

                }
            }
            canvasDiv.addEventListener("touchstart", handleStart)
            const handleEnd = (evt) => {
                evt.preventDefault();

                const touches = evt.changedTouches;
                if (touchState.left)
                        Podium.keyup(37);
                if (touchState.uLeft)
                        Podium.keyup(37);
                if (touchState.right)
                        Podium.keyup(39);
                if (touchState.uRight)
                        Podium.keyup(39);
                if (touchState.middle)
                        Podium.keyup(32);
                touchState = {
                    left: false,
                    right: false,
                    middle: false,
                    uLeft: false,
                    uRight: false,
                }
                
            }
            canvasDiv.addEventListener("touchend", handleEnd)
        }

        document.addEventListener("DOMContentLoaded", startup);
    </script>
</head>

<body id="body">
<center>
    Not by me, forked from <a href="https://github.com/Code-Bullet/Jump-King">code bullet</a>
    <div id="canvas"></div>
</center>

</body>
</html>
